{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supply Unlimited - Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@latest/font/lucide.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
        }

        /* Top Bar */
        .top-bar {
            height: 64px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-mini {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: #6b7280;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-outline {
            background: white;
            color: #6b7280;
            border: 1px solid #d1d5db;
        }

        .btn-outline:hover {
            background: #f9fafb;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 64px);
        }

        /* Sidebar */
        .sidebar {
            width: 256px;
            background: linear-gradient(180deg, #ecfdf5 0%, white 50%, #ecfdf5 100%);
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 24px;
        }

        .sidebar-header h2 {
            font-size: 18px;
            color: #059669;
        }

        .sidebar-menu {
            padding: 12px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .menu-item:hover {
            background: #d1fae5;
        }

        .menu-item.active {
            background: #10b981;
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .menu-item i {
            font-size: 20px;
        }

        /* Content Area */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-header h1 {
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .page-header p {
            color: #6b7280;
        }

        /* Dashboard Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .metric-icon.green {
            background: #d1fae5;
            color: #059669;
        }

        .metric-icon.blue {
            background: #dbeafe;
            color: #2563eb;
        }

        .metric-icon.orange {
            background: #fed7aa;
            color: #ea580c;
        }

        .metric-icon.purple {
            background: #e9d5ff;
            color: #9333ea;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .metric-label {
            color: #6b7280;
            font-size: 14px;
        }

        .metric-change {
            font-size: 12px;
            color: #059669;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-header h3 {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .table-header p {
            font-size: 14px;
            color: #6b7280;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            background: #f9fafb;
            padding: 12px 24px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            border-bottom: 1px solid #e5e7eb;
        }

        tbody td {
            padding: 16px 24px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
            color: #374151;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.in-stock {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.low-stock {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.out-of-stock {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        /* Hidden by default */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="logo-section">
            <div class="logo-mini">SU</div>
            <div class="logo-text">Supply Unlimited</div>
        </div>
        <div class="user-section">
            <div class="user-info">
                <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                <div class="user-role">Administrator</div>
            </div>
            <button class="btn btn-outline" onclick="window.location.href='{% url 'logout' %}'">
                Logout
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Menu</h2>
            </div>
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" onclick="showSection('dashboard'); return false;">
                    <i data-lucide="home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item" onclick="showSection('inventory'); return false;">
                    <i data-lucide="package"></i>
                    <span>Inventory</span>
                </a>
                <a href="#" class="menu-item" onclick="showSection('sales'); return false;">
                    <i data-lucide="trending-up"></i>
                    <span>Sales</span>
                </a>
                <a href="#" class="menu-item" onclick="showSection('orders'); return false;">
                    <i data-lucide="shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="#" class="menu-item" onclick="showSection('companies'); return false;">
                    <i data-lucide="building-2"></i>
                    <span>Companies</span>
                </a>
                <a href="{% url 'sales' %}" class="menu-item">
                    <i data-lucide="bar-chart-3"></i>
                    <span>Analytics</span>
                </a>
                <a href="{% url 'ai_reports' %}" class="menu-item">
                    <i data-lucide="sparkles"></i>
                    <span>AI Reports</span>
                </a>
                <a href="#" class="menu-item" onclick="showSection('customers'); return false;">
                    <i data-lucide="users"></i>
                    <span>Customers</span>
                </a>
                <a href="#" class="menu-item" onclick="showSection('reports'); return false;">
                    <i data-lucide="file-text"></i>
                    <span>Reports</span>
                </a>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section active">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <p>Supply Unlimited - European Operations</p>
                </div>

                <!-- Metrics Cards -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <div>
                                <div class="metric-value">€{{ metrics.total_revenue|floatformat:2 }}</div>
                                <div class="metric-label">Total Revenue</div>
                                <div class="metric-change">↑ 12.5% from last month</div>
                            </div>
                            <div class="metric-icon green">
                                <i data-lucide="euro"></i>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div>
                                <div class="metric-value">{{ metrics.total_orders }}</div>
                                <div class="metric-label">Total Orders</div>
                                <div class="metric-change">↑ 8.2% from last month</div>
                            </div>
                            <div class="metric-icon blue">
                                <i data-lucide="shopping-cart"></i>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div>
                                <div class="metric-value">{{ metrics.total_products }}</div>
                                <div class="metric-label">Products in Stock</div>
                                <div class="metric-change">↑ 3.1% from last month</div>
                            </div>
                            <div class="metric-icon orange">
                                <i data-lucide="package"></i>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div>
                                <div class="metric-value">{{ metrics.active_customers }}</div>
                                <div class="metric-label">Active Customers</div>
                                <div class="metric-change">↑ 5.7% from last month</div>
                            </div>
                            <div class="metric-icon purple">
                                <i data-lucide="users"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Live Stock Inventory</h3>
                        <p>Real-time stock updates across European stores</p>
                    </div>
                    <div id="inventory-table">
                        <div class="loading">Loading inventory data...</div>
                    </div>
                </div>
            </div>

            <!-- Companies Section -->
            <div id="companies-section" class="content-section">
                <div class="page-header">
                    <h1>Company Management</h1>
                    <p>Manage companies and their relationships</p>
                </div>
                <div id="companies-content">
                    <div class="loading">Loading companies...</div>
                </div>
            </div>

            <!-- Other Sections (Placeholder) -->
            <div id="inventory-section" class="content-section">
                <div class="page-header">
                    <h1>Inventory Management</h1>
                    <p>Manage product inventory across all stores</p>
                </div>
            </div>

            <div id="sales-section" class="content-section">
                <div class="page-header">
                    <h1>Sales Analytics</h1>
                    <p>View sales data and trends</p>
                </div>
            </div>

            <div id="orders-section" class="content-section">
                <div class="page-header">
                    <h1>Orders</h1>
                    <p>Manage customer orders</p>
                </div>
            </div>

            <div id="analytics-section" class="content-section">
                <div class="page-header">
                    <h1>Analytics</h1>
                    <p>Business intelligence and reports</p>
                </div>
            </div>

            <div id="customers-section" class="content-section">
                <div class="page-header">
                    <h1>Customers</h1>
                    <p>Customer relationship management</p>
                </div>
            </div>

            <div id="reports-section" class="content-section">
                <div class="page-header">
                    <h1>Reports</h1>
                    <p>Generate and export reports</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            const section = document.getElementById(sectionName + '-section');
            if (section) {
                section.classList.add('active');
            }
            
            // Add active class to clicked menu item
            event.target.closest('.menu-item').classList.add('active');
            
            // Load data for specific sections
            if (sectionName === 'companies') {
                loadCompanies();
            } else if (sectionName === 'dashboard') {
                loadInventory();
            }
        }

        // Load inventory data
        async function loadInventory() {
            try {
                const response = await fetch('/api/inventory/');
                const result = await response.json();
                
                let html = '<table><thead><tr>';
                html += '<th>SKU</th><th>Product Name</th><th>Category</th>';
                html += '<th>Store</th><th>Stock</th><th>Price (€)</th><th>Status</th>';
                html += '<th>Location</th></tr></thead><tbody>';
                
                result.data.forEach(item => {
                    html += `<tr>
                        <td style="font-family: monospace;">${item.sku}</td>
                        <td style="font-weight: 500;">${item.name}</td>
                        <td>${item.category}</td>
                        <td>${item.store}</td>
                        <td style="font-weight: 600;">${item.stock}</td>
                        <td>€${item.price.toFixed(2)}</td>
                        <td><span class="status-badge ${item.status}">${item.status.replace('-', ' ')}</span></td>
                        <td><button class="btn btn-primary" onclick="viewWarehouseLocation('${item.sku}', '${item.store}')">View</button></td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                document.getElementById('inventory-table').innerHTML = html;
            } catch (error) {
                console.error('Error loading inventory:', error);
            }
        }

        // Load companies data
        async function loadCompanies() {
            try {
                const response = await fetch('/companies/', {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                const result = await response.json();
                
                let html = '<div class="table-container"><table><thead><tr>';
                html += '<th>Company ID</th><th>Name</th><th>Parent Company</th>';
                html += '<th>Location</th><th>Ownership %</th><th>Status</th><th>Actions</th>';
                html += '</tr></thead><tbody>';
                
                result.companies.forEach(company => {
                    html += `<tr>
                        <td style="font-family: monospace;">${company.id}</td>
                        <td style="font-weight: 600;">${company.name}</td>
                        <td>${company.parent_name || '<em style="color: #9ca3af;">Main Company</em>'}</td>
                        <td>${company.city}, ${company.country}</td>
                        <td>${company.ownership}%</td>
                        <td><span class="status-badge in-stock">${company.status}</span></td>
                        <td><button class="btn btn-primary" onclick="viewCompany('${company.id}')">Details</button></td>
                    </tr>`;
                });
                
                html += '</tbody></table></div>';
                document.getElementById('companies-content').innerHTML = html;
            } catch (error) {
                console.error('Error loading companies:', error);
            }
        }

        // View warehouse location
        function viewWarehouseLocation(sku, store) {
            alert(`Viewing warehouse location for ${sku} at ${store}\n\nThis will show Aisles > Shelves > Boxes`);
            // Implementar modal com dados da API /api/warehouse/<sku>/
        }

        // View company details
        function viewCompany(companyId) {
            alert(`Viewing details for company ${companyId}\n\nThis will show linked companies and details`);
            // Implementar modal com dados da API /api/company/<company_id>/
        }

        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadInventory();
        });
    </script>
</body>
</html>