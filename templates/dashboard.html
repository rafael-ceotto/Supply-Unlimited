<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Supply Unlimited{% endblock %}

{% block auth_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'sales/css/sales.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@latest/font/lucide.min.css">
{% endblock %}

{% block content %}
<!-- Top Bar -->
<div class="top-bar">
    <div class="logo-section">
        <div class="logo-mini">SU</div>
        <div class="logo-text">Supply Unlimited</div>
    </div>
    <div class="user-section">
        <div class="user-info">
            <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
            <div class="user-role">Administrator</div>
        </div>
        <a href="{% url 'logout' %}" class="btn btn-outline">Logout</a>
    </div>
</div>

<!-- Main Container -->
<div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="menu-item active" onclick="showSection('dashboard'); return false;">
                <i data-lucide="home"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('companies'); return false;">
                <i data-lucide="building-2"></i>
                <span>Companies</span>
            </a>  
            <a href="#" class="menu-item" onclick="showSection('inventory'); return false;">
                <i data-lucide="package"></i>
                <span>Inventory</span>
            </a>
            <a href="#" class="menu-item" onclick="showSection('reports'); return false;">
                <i data-lucide="file-text"></i>
                <span>Reports</span>
                <div class="submenu" style="display: none; margin-top: 8px; margin-left: 24px; border-left: 2px solid #e5e7eb; padding-left: 12px;">
                    <a href="#" class="submenu-item" onclick="showSubsection('reports', 'analytics'); return false;" style="display: block; padding: 8px 0; color: #6b7280; font-size: 14px;">
                        <i data-lucide="trending-up" style="width: 16px; height: 16px; display: inline; margin-right: 8px;"></i>Sales Analytics
                    </a>
                    <a href="#" class="submenu-item" onclick="showSubsection('reports', 'reports'); return false;" style="display: block; padding: 8px 0; color: #6b7280; font-size: 14px;">
                        <i data-lucide="file-text" style="width: 16px; height: 16px; display: inline; margin-right: 8px;"></i>Other Reports
                    </a>
                </div>
            </a>           
        </div>
    </div>

    <!-- Content Area -->
    <div class="content">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section active">
            <div class="page-header">
                <h1>Dashboard</h1>
                <p>Supply Unlimited - European Operations</p>
            </div>

            <!-- Metrics Cards -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div>
                            <div class="metric-value">€{{ metrics.total_revenue|floatformat:2 }}</div>
                            <div class="metric-label">Total Revenue</div>
                            <div class="metric-change">↑ 12.5% from last month</div>
                        </div>
                        <div class="metric-icon green">
                            <i data-lucide="euro"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div>
                            <div class="metric-value">{{ metrics.total_orders }}</div>
                            <div class="metric-label">Total Orders</div>
                            <div class="metric-change">↑ 8.2% from last month</div>
                        </div>
                        <div class="metric-icon blue">
                            <i data-lucide="shopping-cart"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div>
                            <div class="metric-value">{{ metrics.total_products }}</div>
                            <div class="metric-label">Products in Stock</div>
                            <div class="metric-change">↑ 3.1% from last month</div>
                        </div>
                        <div class="metric-icon orange">
                            <i data-lucide="package"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <div>
                            <div class="metric-value">{{ metrics.active_customers }}</div>
                            <div class="metric-label">Active Customers</div>
                            <div class="metric-change">↑ 5.7% from last month</div>
                        </div>
                        <div class="metric-icon purple">
                            <i data-lucide="users"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Sales by Country</h3>
                        <p>Monthly revenue distribution</p>
                    </div>
                    <canvas id="salesChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Stock Distribution</h3>
                        <p>Product status overview</p>
                    </div>
                    <canvas id="stockChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Companies Section -->
        <div id="companies-section" class="content-section">
            <div class="page-header">
                <h1>Company Management</h1>
                <p>Manage companies and their relationships</p>
            </div>
            
            <div class="companies-controls">
                <div class="search-box">
                    <i data-lucide="search"></i>
                    <input type="text" id="companySearch" placeholder="Search companies..." onkeyup="filterCompanies()">
                </div>
                <button class="btn btn-primary" onclick="openCompanyModal()">
                    <i data-lucide="plus"></i> New Company
                </button>
                <button class="btn btn-outline" onclick="openMergeModal()">
                    <i data-lucide="git-merge"></i> Merge Companies
                </button>
            </div>

            <div id="companies-content">
                <div class="loading">Loading companies...</div>
            </div>
        </div>

        <!-- Other Sections (Placeholder) -->
        <div id="inventory-section" class="content-section">
            <div class="page-header">
                <h1>Inventory Management</h1>
                <p>Manage product inventory across all stores</p>
            </div>

            <!-- Search & Filters -->
            <div class="filters-container">
                <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600; color: #1f2937;">Search Inventory</h3>
                <div class="filters-row">
                    <div class="search-box">
                        <i data-lucide="search"></i>
                        <input type="text" id="searchInput" placeholder="Search products, SKU, category..." onkeyup="filterInventory()">
                    </div>
                    <div class="filter-divider"></div>
                    <div class="filter-group">
                        <select id="storeFilter" onchange="filterInventory()" class="filter-select">
                            <option value="all">All Countries</option>
                            <option value="Chile">Chile</option>
                            <option value="USA">USA</option>
                            <option value="Brazil">Brazil</option>
                            <option value="Canada">Canada</option>
                        </select>
                        <select id="categoryFilter" onchange="filterInventory()" class="filter-select">
                            <option value="all">All Categories</option>
                        </select>
                        <select id="stockFilter" onchange="filterInventory()" class="filter-select">
                            <option value="all">All Stock</option>
                            <option value="Low">Low Stock</option>
                            <option value="Medium">Medium Stock</option>
                            <option value="High">High Stock</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="exportInventory()" style="white-space: nowrap;">
                        <i data-lucide="download" style="width: 16px; height: 16px;"></i> Export
                    </button>
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title-section">
                        <h3>Live Stock Inventory</h3>
                        <p>Real-time stock updates across European stores</p>
                    </div>
                    <div class="table-actions">
                        <button class="btn btn-outline" onclick="exportInventory('csv')" title="Export as CSV">
                            <i data-lucide="table" style="width: 16px; height: 16px;"></i> CSV
                        </button>
                        <button class="btn btn-outline" onclick="exportInventory('json')" title="Export as JSON">
                            <i data-lucide="file-json" style="width: 16px; height: 16px;"></i> JSON
                        </button>
                        <button class="btn btn-outline" onclick="exportInventory('parquet')" title="Export as Parquet">
                            <i data-lucide="database" style="width: 16px; height: 16px;"></i> Parquet
                        </button>
                        <button class="btn btn-outline" onclick="refreshInventory()">
                            <i data-lucide="refresh-cw"></i> Refresh
                        </button>
                    </div>
                </div>
                <div id="inventory-table">
                    <div class="loading">Loading inventory data...</div>
                </div>
            </div>
        </div>

        <div id="reports-section" class="content-section">
            <div class="page-header">
                <h1>Reports</h1>
                <p>Generate and export reports</p>
            </div>

            <!-- Sub-tabs for Reports -->
            <div style="display: flex; gap: 12px; margin-bottom: 24px; border-bottom: 2px solid #e5e7eb; padding-bottom: 0; overflow-x: auto;">
                <button class="tab-button active" onclick="showSubsection('reports', 'analytics'); return false;" style="padding: 12px 16px; border: none; background: none; font-size: 14px; font-weight: 600; color: #111827; cursor: pointer; border-bottom: 3px solid #2563eb; margin-bottom: -2px; white-space: nowrap;">
                    <i data-lucide="trending-up" style="width: 16px; height: 16px; display: inline; margin-right: 6px;"></i>Sales Analytics
                </button>
                <button class="tab-button" onclick="showSubsection('reports', 'risk'); return false;" style="padding: 12px 16px; border: none; background: none; font-size: 14px; font-weight: 600; color: #6b7280; cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; white-space: nowrap;">
                    <i data-lucide="alert-triangle" style="width: 16px; height: 16px; display: inline; margin-right: 6px;"></i>Risk Report
                </button>
                <button class="tab-button" onclick="showSubsection('reports', 'sustainability'); return false;" style="padding: 12px 16px; border: none; background: none; font-size: 14px; font-weight: 600; color: #6b7280; cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; white-space: nowrap;">
                    <i data-lucide="leaf" style="width: 16px; height: 16px; display: inline; margin-right: 6px;"></i>Sustainability
                </button>
                <button class="tab-button" onclick="showSubsection('reports', 'inventory'); return false;" style="padding: 12px 16px; border: none; background: none; font-size: 14px; font-weight: 600; color: #6b7280; cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; white-space: nowrap;">
                    <i data-lucide="package" style="width: 16px; height: 16px; display: inline; margin-right: 6px;"></i>Inventory Report
                </button>
            </div>

            <!-- Sales Analytics Sub-section -->
            <div id="subsection-analytics" style="display: block;">
                <!-- Search Company Section -->
                <div class="search-container" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <div style="width: 48px; height: 48px; background: #dbeafe; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="search" style="width: 24px; height: 24px; color: #2563eb;"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin: 0 0 4px 0;">Search Company</h3>
                            <p style="font-size: 14px; color: #6b7280; margin: 0;">Find detailed sales analytics and market insights</p>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 12px; align-items: flex-end;">
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Company Name</label>
                            <input type="text" id="sales-company-name" placeholder="Enter company name..." style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Sector</label>
                            <select id="sales-sector" style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                                <option value="all">All Sectors</option>
                                <option value="Technology">Technology</option>
                                <option value="Finance">Finance</option>
                                <option value="Retail">Retail</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Country</label>
                            <select id="sales-country" style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                                <option value="all">All Countries</option>
                                <option value="Germany">Germany</option>
                                <option value="France">France</option>
                                <option value="Spain">Spain</option>
                            </select>
                        </div>
                        <button onclick="searchSalesCompany()" class="btn btn-primary" style="height: 40px; padding: 0 24px;">Search</button>
                    </div>
                </div>

                <!-- Results Container -->
                <div id="sales-results-container" style="display: none;">
                    <!-- Company Header -->
                    <div id="sales-company-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; padding: 24px; color: white; margin-bottom: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="font-size: 24px; font-weight: 700;" id="sales-company-name-display"></div>
                        <div style="font-size: 14px; opacity: 0.9; margin-top: 4px;" id="sales-company-sector-display"></div>
                    </div>

                    <!-- KPI Cards -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 4px solid #10b981;">
                            <div style="color: #6b7280; font-size: 13px; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">Revenue YTD</div>
                            <div style="font-size: 28px; font-weight: 700; color: #10b981;" id="sales-revenue-ytd">—</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 8px;" id="sales-revenue-change">—</div>
                        </div>
                        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 4px solid #2563eb;">
                            <div style="color: #6b7280; font-size: 13px; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">Profit YTD</div>
                            <div style="font-size: 28px; font-weight: 700; color: #2563eb;" id="sales-profit-ytd">—</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 8px;" id="sales-profit-change">—</div>
                        </div>
                        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 4px solid #ea580c;">
                            <div style="color: #6b7280; font-size: 13px; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">Prediction Next YTD</div>
                            <div style="font-size: 28px; font-weight: 700; color: #ea580c;" id="sales-prediction-ytd">—</div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 8px;" id="sales-prediction-growth">—</div>
                        </div>
                    </div>

                    <!-- Market Position -->
                    <div style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 24px;">
                        <div style="padding: 24px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="font-size: 16px; font-weight: 600; color: #111827; margin: 0;">Market Position - Competitor Ranking</h3>
                        </div>
                        <div id="sales-competitors-table" style="overflow-x: auto;"></div>
                    </div>

                    <!-- Top Selling Products -->
                    <div style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                        <div style="padding: 24px; border-bottom: 1px solid #e5e7eb;">
                            <h3 style="font-size: 16px; font-weight: 600; color: #111827; margin: 0;">Top Selling Products</h3>
                        </div>
                        <div id="sales-products-list" style="padding: 24px;"></div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="sales-empty-state" style="text-align: center; padding: 60px 24px;">
                    <div style="width: 80px; height: 80px; background: #f3f4f6; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                        <i data-lucide="search" style="width: 40px; height: 40px; color: #d1d5db;"></i>
                    </div>
                    <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin: 0 0 8px 0;">Search for a Company</h3>
                    <p style="color: #6b7280; margin: 0;">Enter a company name above to view detailed sales analytics and insights</p>
                </div>
            </div>

            <!-- Other Reports Sub-section -->
            <div id="subsection-risk" style="display: none;">
                <div class="page-header" style="margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: #fee2e2; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="alert-triangle" style="width: 24px; height: 24px; color: #dc2626;"></i>
                        </div>
                        <div>
                            <h2 style="font-size: 24px; font-weight: 700; margin: 0;">Risk & Exceptions Report</h2>
                            <p style="color: #6b7280; margin: 0; font-size: 14px;">Supply Chain Risk Analysis</p>
                        </div>
                    </div>
                </div>

                <!-- Risk Filters -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                    <div>
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Period</label>
                        <select style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                            <option>Last 7 Days</option>
                            <option selected>Last 30 Days</option>
                            <option>Last 90 Days</option>
                            <option>Year to Date</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Country</label>
                        <select style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                            <option selected>All Countries</option>
                            <option>Germany</option>
                            <option>France</option>
                            <option>Italy</option>
                            <option>Spain</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">SKU</label>
                        <input type="text" placeholder="Filter by SKU..." style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Supplier</label>
                        <select style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-family: inherit; outline: none;">
                            <option selected>All Suppliers</option>
                            <option>Supplier A</option>
                            <option>Supplier B</option>
                        </select>
                    </div>
                </div>

                <!-- Risk KPI Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div style="background: white; border-radius: 12px; padding: 24px; border-left: 4px solid #dc2626; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <div style="width: 40px; height: 40px; background: #fee2e2; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i data-lucide="alert-triangle" style="width: 20px; height: 20px; color: #dc2626;"></i>
                            </div>
                            <div style="font-size: 13px; font-weight: 600; color: #6b7280;">SKUs at Risk</div>
                        </div>
                        <div style="font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 4px;">23.5%</div>
                        <div style="font-size: 13px; color: #dc2626;">Stock out risk</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 24px; border-left: 4px solid #f97316; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <div style="width: 40px; height: 40px; background: #fef3c7; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i data-lucide="clock" style="width: 20px; height: 20px; color: #f97316;"></i>
                            </div>
                            <div style="font-size: 13px; font-weight: 600; color: #6b7280;">High Lead Time</div>
                        </div>
                        <div style="font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 4px;">156</div>
                        <div style="font-size: 13px; color: #f97316;">Orders above P95</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 24px; border-left: 4px solid #eab308; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <div style="width: 40px; height: 40px; background: #fef08a; border-radius: 8px; display: flex; align-items: center; justify-center;">
                                <i data-lucide="truck" style="width: 20px; height: 20px; color: #eab308;"></i>
                            </div>
                            <div style="font-size: 13px; font-weight: 600; color: #6b7280;">Critical Suppliers</div>
                        </div>
                        <div style="font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 4px;">8</div>
                        <div style="font-size: 13px; color: #eab308;">High dependency</div>
                    </div>
                    <div style="background: white; border-radius: 12px; padding: 24px; border-left: 4px solid #22c55e; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <div style="width: 40px; height: 40px; background: #dcfce7; border-radius: 8px; display: flex; align-items: center; justify-center;">
                                <i data-lucide="trending-down" style="width: 20px; height: 20px; color: #22c55e;"></i>
                            </div>
                            <div style="font-size: 13px; font-weight: 600; color: #6b7280;">OTIF Performance</div>
                        </div>
                        <div style="font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 4px;">87.2%</div>
                        <div style="font-size: 13px; color: #22c55e;">On-time, in-full</div>
                    </div>
                </div>

                <!-- Risk Exceptions Table -->
                <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
                        <i data-lucide="alert-octagon" style="width: 20px; height: 20px; color: #dc2626;"></i>
                        <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin: 0;">Top Exceptions</h3>
                    </div>
                    <div style="space-y: 12px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 16px; background: #f9fafb; border-radius: 8px; font-weight: 600; font-size: 13px; color: #6b7280;">
                            <div>SKU</div>
                            <div>Country</div>
                            <div>Problem</div>
                            <div>Impact (€)</div>
                            <div>Severity</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 16px; border-bottom: 1px solid #e5e7eb; align-items: center;">
                            <div style="font-weight: 600; color: #111827;">SUP-2847</div>
                            <div style="color: #6b7280;">Spain</div>
                            <div style="color: #6b7280;">Stock Out Risk</div>
                            <div style="font-weight: 600; color: #111827;">€45,000</div>
                            <div><span style="display: inline-block; padding: 4px 8px; background: #fee2e2; color: #dc2626; border-radius: 6px; font-size: 12px; font-weight: 600;">Critical</span></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 12px; padding: 16px; border-bottom: 1px solid #e5e7eb; align-items: center;">
                            <div style="font-weight: 600; color: #111827;">SUP-1923</div>
                            <div style="color: #6b7280;">Italy</div>
                            <div style="color: #6b7280;">Delayed Shipment</div>
                            <div style="font-weight: 600; color: #111827;">€38,500</div>
                            <div><span style="display: inline-block; padding: 4px 8px; background: #fee2e2; color: #dc2626; border-radius: 6px; font-size: 12px; font-weight: 600;">Critical</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sustainability Sub-section -->
            <div id="subsection-sustainability" style="display: none;">
                <div class="page-header" style="margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: #dcfce7; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="leaf" style="width: 24px; height: 24px; color: #22c55e;"></i>
                        </div>
                        <div>
                            <h2 style="font-size: 24px; font-weight: 700; margin: 0;">Sustainability Report</h2>
                            <p style="color: #6b7280; margin: 0; font-size: 14px;">Environmental & Social Impact</p>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; padding: 80px 24px; background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="width: 80px; height: 80px; background: #f3f4f6; border-radius: 12px; display: flex; align-items: center; justify-center; margin: 0 auto 20px;">
                        <i data-lucide="leaf" style="width: 40px; height: 40px; color: #d1d5db;"></i>
                    </div>
                    <h3 style="font-size: 20px; font-weight: 600; color: #111827; margin: 0 0 8px 0;">Sustainability Metrics</h3>
                    <p style="color: #6b7280; margin: 0; max-width: 500px; margin: 0 auto;">Carbon footprint analysis, waste reduction initiatives, and environmental compliance reports coming soon</p>
                </div>
            </div>

            <!-- Inventory Report Sub-section -->
            <div id="subsection-inventory" style="display: none;">
                <div class="page-header" style="margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: #e0e7ff; border-radius: 8px; display: flex; align-items: center; justify-center;">
                            <i data-lucide="package" style="width: 24px; height: 24px; color: #4f46e5;"></i>
                        </div>
                        <div>
                            <h2 style="font-size: 24px; font-weight: 700; margin: 0;">Inventory Report</h2>
                            <p style="color: #6b7280; margin: 0; font-size: 14px;">Stock Levels & Warehouse Analysis</p>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; padding: 80px 24px; background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="width: 80px; height: 80px; background: #f3f4f6; border-radius: 12px; display: flex; align-items: center; justify-center; margin: 0 auto 20px;">
                        <i data-lucide="package" style="width: 40px; height: 40px; color: #d1d5db;"></i>
                    </div>
                    <h3 style="font-size: 20px; font-weight: 600; color: #111827; margin: 0 0 8px 0;">Stock Analysis</h3>
                    <p style="color: #6b7280; margin: 0; max-width: 500px; margin: 0 auto;">Detailed inventory metrics, warehouse utilization, and stock movement trends detailed analysis coming soon</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Company Modal -->
<div id="companyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>New Company</h2>
            <button class="modal-close" onclick="closeCompanyModal()">×</button>
        </div>
        <form id="companyForm" onsubmit="saveCompany(event)">
            <div class="form-group">
                <label>Company Name *</label>
                <input type="text" id="companyName" required>
            </div>
            <div class="form-group">
                <label>Country *</label>
                <input type="text" id="companyCountry" required>
            </div>
            <div class="form-group">
                <label>City *</label>
                <input type="text" id="companyCity" required>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select id="companyStatus">
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                    <option value="pending">Pending</option>
                </select>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeCompanyModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Company</button>
            </div>
        </form>
    </div>
</div>

<!-- Merge Companies Modal -->
<div id="mergeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Merge Companies</h2>
            <button class="modal-close" onclick="closeMergeModal()">×</button>
        </div>
        <div style="margin-bottom: 16px; padding: 12px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
            <p style="font-size: 13px; color: #92400e;">⚠️ This will merge the source company into the target company. All stores and subsidiaries will be transferred.</p>
        </div>
        <form id="mergeForm" onsubmit="mergeCompanies(event)">
            <div class="form-group">
                <label>Source Company (To merge FROM) *</label>
                <select id="sourceCompany" required>
                    <option value="">Select a company...</option>
                </select>
            </div>
            <div style="text-align: center; margin: 16px 0;">
                <i data-lucide="arrow-down" style="width: 24px; height: 24px; color: #10b981;"></i>
            </div>
            <div class="form-group">
                <label>Target Company (To merge INTO) *</label>
                <select id="targetCompany" required>
                    <option value="">Select a company...</option>
                </select>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeMergeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" style="background: #ef4444;">Merge Companies</button>
            </div>
        </form>
    </div>
</div>

<!-- Warehouse Location Modal -->
<div id="warehouseModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <div>
                <h2 id="warehouseTitle">Warehouse Location</h2>
                <p id="warehouseSKU" style="font-size: 13px; color: #6b7280; margin-top: 4px;"></p>
            </div>
            <button class="modal-close" onclick="closeWarehouseModal()">×</button>
        </div>
        
        <div id="warehouseContent" style="max-height: 500px; overflow-y: auto;">
            <div class="loading" style="text-align: center; padding: 40px;">Carregando localização...</div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}
